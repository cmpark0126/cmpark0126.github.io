---
title:  "운영체제(9) - Virtual Memory(1)"
modified: 2019-05-14T12:00:00-:30:00
categories:
  - Operating_System
tags:
  - [CS, Operating_System]
---

'운영체제'를 공부하여 정리한 내용입니다.

## 1. Background

### 유용성

-   프로세스 전체가 메인 메모리 내에 올라오지 않더라도 실행이 가능하도록 한다.
    -   말인즉슨, 메인메모리 전체 크기가 프로세스의 크기보다 작아도 시스템이 프로그램을 돌릴 수 있도록 할 수 있다는 것이다.

### 필요성

-   이 때까지는 현재 실행되고 잇는 코드는 반드시 메인 메모리에 존재해야 한다는 기본적인 요구 조건을 만족해야 했다.

    -   Dynamic Loading과 같은 방식으로 전체 코드 중에 필요한 부분만 올리는 방식으로 요구 조건을 완화하여 수행 할 수 있었다.
    -   [운영체제(8) - Memory Management Strategies(1) - Dynamic Loading](https://cmpark0126.github.io/operating_system/OS_8-1/#dynamic-loading) 참고

-   프로세스를 모두 메인 메모리에 올리는 것은, 비용을 매우 많이 드는 작업이며 아래와 같은 상황이 있다면 낭비가 될 수 있다.

    1.  프로세스 동작 가운데 거의 사용하지 않는 루틴
        -   오류 상황을 처리하는 Exception 코드 등
    2.  배열, 리스트 등의 자료구조를 사용할 때, 실제 사용하는 공간보다 많이 배치되어 있는 경우
    3.  프로그램 내의 어떤 option이나 루틴의 경우는 아주 가끔 사용된다.

-   우리는 위와 같은 부분은 실제로는 딱히 메인 메모리에 없어도 된다는 것을 쉽게 알 수 있다.
    -   물론 필요할 때는 올려야 한다.

### 장점

-   프로그램은 더 이상 메인 메모리의 크기에 제약 받지 않는다.
-   각 사용자 프로그램이 더 작은 메모리를 차지하여, Multiprogramming에 많은 이점을 준디ㅏ.
    -   처리량 증가
    -   응답 시간 축소
-   Swap같은 기술을 사용할 때, 메모리에 실제로 차지하는 부분이 작아서 프로그램 실행 등과, 보조 메모리로의 후퇴가 빨라진다.
    -   [운영체제(8) - Memory Management Strategies(1) - Swapping](https://cmpark0126.github.io/operating_system/OS_8-1/#2-swapping) 참고

### Virtual Memory

-   Virtual Memory는 위의 이점을 얻기 위한 추상적 개념으로, 실제의 Physical memory(메인 메모리) concepts와 사용자의 Logical Memory concepts를 분리할 수 있게 된다.
    -   이 덕분에 사용자는 실제보다 더 큰 메인메모리를 사용하는 것과 같은 환상을 느낄 수 있게 된다.
    -   실제로 이 기술은 작은 메인 메모리로 충분히 큰 공간의 Virtual Memory를 제공한다.

### Virtual Address Space

-   한 프로세스가 가진 일종의 논리적 공간이다.

    -   텍스트: 프로그램 코드(기계어)
    -   데이터: 전역 변수
    -   Stack
    -   Heap

-   가상 공간에서는 이들이 연속적인 모습을 가지지만 실제로는 그렇지 않다는 것을 이제는 다 알것이다.

    -   Logical Page를 Physical Page로 매핑하는 것은 MMU(Memory Management Unit)에서 해준다.

-   이 때 Stack이나 Heap은 프로세스 사용 도중에 증가하는 영역이다.
    -   증가되지 않을 때는, 실제 Physical 공간을 요청할 필요가 없다.
    -   이런 부분은 그림에서는 자주 Heap 과 Stack의 사잇공간으로 표현되고, 이를 우리는 Sparse Address Space라고 표현한다.

### 추가적인 장점

-   메모리 공유 작업을 효과적으로 하면서, User의 입장에서는 숨길 수 있다. (물리적인 공간은 공유하지만, 가상 공간을 따로 쓰는 것처럼 보이게 하여 사용자 인터페이스를 직관적으로 한다.)
    -   시스템 라이브러리를 공유할 때 효과적으로 진행할 수 있다.
    -   프로세스가 메모리의 특정 부분을 공유하게 할 수 있도록 한다.
-   또한 Fork()등의 프로세스 복사 생성 작업에서 공유할 부분은 빠르게 공유하고, 필요한 부분의 물리 메모리만 차지하여 그 생성 속도를 이전보다 빠르게 하는 것이 가능하다.

## 2.  Demand Paging
